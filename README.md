## PyModflow-demo ç®€ä»‹

ç”¨modflowæ¨¡æ‹Ÿåœ°ä¸‹æ°´ï¼Œæº¶è´¨è¿ç§»ï¼Œæº¯æºã€‚åˆ©ç”¨GMSé¢„å¤„ç†ä¸è§„åˆ™è¾¹ç•Œã€‚

1. `modflow_ipynbookæ–‡ä»¶å¤¹`ä¸­çš„`modflowæœ€ç»ˆåŠŸèƒ½å®ç°-2Dè½¬åŒ–-æº¯æº-addæ²³æµ-chdæ’å€¼-æ­£ç¡®.ipynb`è¿™ä¸ªæ–‡ä»¶æ˜¯æœ€å®Œæ•´çš„æ–‡ä»¶ã€‚
2. `modflowæ–‡ä»¶å¤¹`å†…æ˜¯`modflowçš„å¯æ‰§è¡Œæ–‡ä»¶`ï¼ŒåŒ…æ‹¬modflowã€modpathã€mt3dmsç­‰ã€‚ç”¨åˆ°çš„ä¸º
   - modflow\mp7
   - modflow\mf6
3. ç”¨åˆ° python çš„åŒ…ä¸º FloPy å’Œ h5pyï¼Œflowpyå¯ä»¥æ”¯æŒå¦‚ä¸‹çš„[modflowæ¨¡å‹](https://github.com/modflowpy/flopy/blob/58cb48e7a6240d2a01039b5a5ab3c67c5111662c/docs/supported_packages.md#flopy-supported-packages)ï¼Œ


å½“æ¨¡å‹é‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œå¯ä»¥æŸ¥æ‰¾æºç ä¸­çš„æ³¨é‡Šï¼Œå¦‚ä¸‹ä¸º[flopyçš„æºç ](https://github.com/modflowpy/flopy/tree/cb8c21907ef35172c792419d59e163a86e6f0939/flopy/mf6/modflow)ã€[modpathçš„æºç ](https://github.com/modflowpy/flopy/tree/a13f8b940c9057d18732d8d49ec25d2b9b2f362e/flopy/modpath)ã€[modflow 6çš„å®˜æ–¹æ‰‹å†Œ](https://flopy.readthedocs.io/en/latest/_notebooks/tutorial03_mf6_data.html)

å¦‚ä¸‹ä¸º[modflowçš„å®˜æ–¹æ•™ç¨‹](https://github.com/modflowpy/flopy/blob/78e42643ebc8eb5ca3109de5b335e18c3c6e8159/docs/notebook_examples.md)ï¼Œéœ€ç”¨jupyter notebookæ‰“å¼€ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿›å…¥è¿™ä¸ª[ç›®å½•](https://github.com/modflowpy/flopy/tree/2749f16765b70d842940f4be79c169aa0c03ee74/examples/Notebooks)


1. å¦‚æœæƒ³è¦äº†è§£éå‡åŒ€ç½‘æ ¼ï¼Œå¯ä»¥å‚è€ƒ[è¿™ä¸ªé“¾æ¥](https://github.com/modflowpy/flopy/blob/78e42643ebc8eb5ca3109de5b335e18c3c6e8159/examples/Notebooks/flopy3_gridgen.ipynb)

2. å¦‚ä¸‹æ˜¯modpathæ¯”è¾ƒå¥½çš„[æ•™ç¨‹1ç»“æ„åŒ–ç½‘æ ¼](https://github.com/modflowpy/flopy/blob/78e42643ebc8eb5ca3109de5b335e18c3c6e8159/examples/Notebooks/flopy3_modpath7_structured_example.ipynb)å’Œ[æ•™ç¨‹2éç»“æ„ç½‘æ ¼](https://github.com/modflowpy/flopy/blob/78e42643ebc8eb5ca3109de5b335e18c3c6e8159/examples/Notebooks/flopy3_modpath7_unstructured_example.ipynb)ï¼š

3. å¦‚ä¸‹æ˜¯[mt3dmså‚å‘çš„æ¨¡å‹](https://github.com/modflowpy/flopy/blob/78e42643ebc8eb5ca3109de5b335e18c3c6e8159/examples/Notebooks/flopy3_MT3DMS_examples.ipynb)æ•™ç¨‹

4. [å°†æ¨¡å‹ç»“æœå¯¼å‡ºæˆshpæˆ–è€…tif](https://github.com/modflowpy/flopy/blob/78e42643ebc8eb5ca3109de5b335e18c3c6e8159/examples/Notebooks/flopy3_Modflow_postprocessing_example.ipynb)

## å…³äºå¸¸å·åœŸå£¤å’Œåœ°ä¸‹æ°´é¢„è­¦ç³»ç»Ÿï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹é¡¹ç›®

[æå–ç«™ç‚¹æ±¡æŸ“ç‰©æµ“åº¦æˆ–è€…ç«™ç‚¹æ’æ”¾](https://github.com/AlfreadChen/city_coap)

[ä¸‡ç¿æ™ºæ…§å›­åŒºè§£å†³æ–¹æ¡ˆ](https://market.cloud.tencent.com/products/36456)

[RAMEV C4 æ™ºèƒ½æ•°æ®é‡‡é›†é€šè®¯ç»ˆç«¯](https://market.cloud.tencent.com/products/22792)

[ç‰©è”ç½‘å¡è´´ç‰‡å¡å·¥ä¸šç‰©è”ç½‘å¡æµé‡å¡](https://market.cloud.tencent.com/products/29414)

[4Gç½‘å…³ WIFIç½‘å…³ ç½‘å…³æ¨¡ç»„ å®¶åº­ç½‘å…³ æ™ºèƒ½å®¶å±… æ™ºèƒ½ç¡¬ä»¶ meshæ¨¡ç»„ ZigBeeæ¨¡ç»„](https://market.cloud.tencent.com/products/18251)

[æ™ºæ…§æ°´åŠ¡ç®¡ç†å¹³å°æ™ºèƒ½æ°´è¡¨æ°´è´¨ç›‘æµ‹ç³»ç»Ÿå¹³å°è®¾å¤‡å®‰è£…æ–½å·¥è¿ç»´è½åœ°å®šåˆ¶è½¯ä»¶å¼€å‘æºç ](https://market.cloud.tencent.com/products/24303)

[å†œä¸šç‰©è”ç½‘å¤§æ•°æ®å¹³å°](https://market.cloud.tencent.com/products/33844)

[æ™ºæ…§åŸå¸‚æ•°å­—å­ªç”Ÿå¯è§†åŒ–ç®¡ç†å¹³å°](https://market.cloud.tencent.com/products/34588)

[å°ç¨‹åºå®šåˆ¶å¼€å‘ -IoTã€æ™ºèƒ½å®¶å±…ã€ç‰©è”ç½‘ã€è½¦è”ç½‘ã€æ™ºæ…§åŸå¸‚ã€åŒ»ç–—å¥åº·](https://market.cloud.tencent.com/products/14107)

## å°ç™½é›¶åŸºç¡€å…¥é—¨

éœ€è¦å®‰è£…ï¼š

1. VScode - ç”¨äºç¼–ç¨‹
   - éœ€è¦å®‰è£…ä¸€äº›æ’ä»¶æ¯”å¦‚ï¼špythonç›¸å…³çš„å„ç§æ’ä»¶
2. æŸVPN - ç”¨äºç¿»å¢™
3. win10ç³»ç»Ÿ - åœ¨è½¯ä»¶å•†åº—å®‰è£… Debian è™šæ‹Ÿæœº
   - ä¹Ÿå¯å®‰è£… Ubuntu æˆ–è€… CentOS
4. ä¸€ä¸ªGithubè´¦æˆ·

## pythonåŸºç¡€

```py
ä¸»è¦çš„æ•°æ®ç»“æ„åŒ…æ‹¬ï¼š

- list ç”¨ [] è¡¨ç¤º
- dictionary ç”¨ {} è¡¨ç¤º

éœ€è¦å­¦ä¹ ä¸€äº› numpyã€matplotlib çš„åŸºç¡€
- np.ones() è¡¨ç¤ºåˆ›å»ºéƒ½æ˜¯1çš„çŸ©é˜µ
- np.zeros() è¡¨ç¤ºåˆ›å»ºéƒ½æ˜¯0çš„çŸ©é˜µ
- ç­‰ç­‰

import å¯¼å…¥åŒ…
def åˆ›å»ºå‡½æ•°
print æ‰“å°


"",'' éƒ½è¡¨ç¤ºå­—ç¬¦
for è¡¨ç¤ºå¾ªç¯

range(5) è¡¨ç¤ºåˆ›å»ºä¸€ä¸ª[0,1,2,3,4]çš„list

```

## è¿›è¡Œä¸€äº›åŸºç¡€é…ç½®

Debianè™šæ‹Ÿæœºæ‰“å¼€ï¼š

```sh
sudo apt-get update
sudo apt-get upgrade
```

å®‰è£…pythonç›¸å…³çš„åŒ…

```sh
sudo install python3 pip
pip install flopy 
pip install numpy
pip install h5py
pip install matplotlib
```

èµ‹äºˆæƒé™

```sh
sudo chmod -R 777 /å½“å‰ç›®å½•
```

## è¿›å…¥jupyterNotebookå°è¯•è·‘ä¸€è·‘

### ç ´è§£h5

```py
import h5py 
import numpy as np
```

è¾“å…¥h5æ–‡ä»¶æ‰€åœ¨ä½ç½®

```py
sim_name_ini = "2022.10.20-FJMFQF"
sim_ws_ini = "2022.10.20-FJMFQF_MODFLOW"
```

è¯»å–h5é‡Œé¢çš„å†…å®¹ï¼Œç¡®è®¤ä¸€ä¸‹è·¯å¾„å¯¹ä¸å¯¹ï¼Œå¦‚æœä¸å¯¹ï¼Œè·¯å¾„éœ€è¦ä¿®æ”¹

```py
f1 = h5py.File("/home/nandahgy/yqc_model/" + sim_ws_ini + "/" + sim_name_ini + ".h5",'r')
f2 = h5py.File("/home/nandahgy/yqc_model/" + sim_ws_ini + "/" + sim_name_ini + ".hed.h5",'r')
```

#### è¯»å–f1

è¯»å–æ¨¡å‹çš„ç¦»æ•£å±‚æ•°

```py
NROW = 213
NCOL = 283
NLAY = 4
```

è¯»å–f1é‡Œé¢çš„idomainçš„å€¼ï¼Œä»£è¡¨æ¨¡å‹çš„åŸŸï¼Œæ˜¯ä¸€ä¸ª3ç»´çš„çŸ©é˜µ

```py
nums = [0] * (NROW * NCOL)
idomain = np.ones((NLAY, NROW, NCOL), dtype = int) # å‚ä¸æ¨¡æ‹Ÿçš„åŒºåŸŸï¼Œ1 ä¸ºå‚ä¸
for layi in range(NLAY):
  iboundname = 'ibound' + str(layi + 1)
  nums = list(f1['Arrays'][iboundname])
  tmp = []
  for rowi in range(NROW):
    tmp.append(nums[rowi * NCOL:(1 + rowi) * NCOL])
  idomain[layi,:,:] = np.array(tmp)
```

è®¾ç½®sconcåˆå§‹æµ“åº¦ï¼Œå¹¶ä»f1é‡Œé¢è¯»å–strtåˆå§‹æ°´å¤´

```py
# åˆå§‹æ¡ä»¶: # Initial conditions
# Starting concentrations åˆå§‹æµ“åº¦
sconc = 0.0
# Starting Heads åˆå§‹æ°´å¤´
nums = [0] * (NROW * NCOL)
strt = np.zeros((NLAY, NROW, NCOL), dtype=float)

for layi in range(NLAY):
  StartHeadname = 'StartHead' + str(layi + 1)
  nums = list(f1['Arrays'][StartHeadname])
  tmp = []
  for rowi in range(NROW):
    tmp.append(nums[rowi * NCOL:(1 + rowi) * NCOL])
  strt[layi,:,:] = np.array(tmp)
```

ä»f1è¯»å–topå’Œbotçš„å€¼ï¼Œå°±æ˜¯é¡¶å’Œåº•

```py
nums = list(f1['Arrays']['top1'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
top1 = np.array(tmp)

nums = list(f1['Arrays']['bot1'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
bot1 = np.array(tmp)

nums = list(f1['Arrays']['bot2'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
bot2 = np.array(tmp)

nums = list(f1['Arrays']['bot3'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
bot3 = np.array(tmp)

nums = list(f1['Arrays']['bot4'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
bot4 = np.array(tmp)

bottoms = np.zeros((NLAY, NROW, NCOL), dtype=float)
bottoms[0,:,:] = bot1
bottoms[1,:,:] = bot2
bottoms[2,:,:] = bot3
bottoms[3,:,:] = bot4
```

æ‰“å°å‡ºæ¥çœ‹çœ‹ï¼Œstrtå’Œtopã€bottomçš„å€¼æ˜¯å¦æ¥è¿‘ã€‚

å¦‚æœä¸æ¥è¿‘ï¼Œè¯´æ˜ï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯ï¼Œæ¨¡å‹æ— æ³•æ”¶æ•›ã€‚

```py
print(strt[0,100,100])
print(strt[1,100,100])
print(strt[2,100,100])
print(strt[3,100,100])
print("top1:",top1[100,100])
print("bot1:",bot1[100,100])
print("bot2:",bot2[100,100])
print("bot3:",bot3[100,100])
print("bot4:",bot4[100,100])

# 5.0
# -2.0
# -18.0
# -35.0
# top1: 5.0
# bot1: -2.0
# bot2: -18.0
# bot3: -35.0
# bot4: -75.06968688964844
```

ä»f1è¯»å–æ¸—é€ç³»æ•°ï¼ŒåŒ…æ‹¬ï¼š

1. HK1ã€HK2ã€HK3ã€HK4
2. HANI1ã€HANI2ã€HANI3ã€HANI4
3. VANI1ã€VANI2ã€VANI3ã€VANI4

```py
nums = list(f1['Arrays']['HK1'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
HK1 = np.array(tmp)

nums = list(f1['Arrays']['HK2'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
HK2 = np.array(tmp)

nums = list(f1['Arrays']['HK3'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
HK3 = np.array(tmp)

nums = list(f1['Arrays']['HK4'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
HK4 = np.array(tmp)

nums = list(f1['Arrays']['HANI1'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
HANI1 = np.array(tmp)

nums = list(f1['Arrays']['HANI2'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
HANI2 = np.array(tmp)

nums = list(f1['Arrays']['HANI3'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
HANI3 = np.array(tmp)

nums = list(f1['Arrays']['HANI4'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
HANI4 = np.array(tmp)

nums = list(f1['Arrays']['VANI1'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
VANI1 = np.array(tmp)

nums = list(f1['Arrays']['VANI2'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
VANI2 = np.array(tmp)

nums = list(f1['Arrays']['VANI3'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
VANI3 = np.array(tmp)

nums = list(f1['Arrays']['VANI4'])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
VANI4 = np.array(tmp)

HKs = np.zeros((NLAY, NROW, NCOL), dtype=float)
HKs[0,:,:] = HK1
HKs[1,:,:] = HK2
HKs[2,:,:] = HK3
HKs[3,:,:] = HK4
```

æŸ¥çœ‹ä¸€ä¸‹åˆšåˆšè¯»å–çš„å†…å®¹æ˜¯å¦æ­£ç¡®

```py
print("HK1:",HK1[100,100])
print("HK2:",HK2[100,100])
print("HK3:",HK3[100,100])
print("HK4:",HK4[100,100])
print("HANI å’Œ VANI éƒ½æ˜¯æ¯”å€¼")
print("HANI1:",HANI1[100,100])
print("HANI2:",HANI2[100,100])
print("HANI3:",HANI3[100,100])
print("HANI4:",HANI4[100,100])
print("VANI1:",VANI1[100,100])
print("VANI2:",VANI2[100,100])
print("VANI3:",VANI3[100,100])
print("VANI4:",VANI4[100,100])
```

ä»f1è¯»å–è’¸å‘å’Œè¡¥ç»™

```py
nums = list(f1['Recharge']['07. Property'][0,:,0])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
rch = np.array(tmp)

nums = list(f1['ET']['07. Property'][0,:,0])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
et_surf = np.array(tmp)

nums = list(f1['ET']['07. Property'][1,:,0])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
et_rat = np.array(tmp)

nums = list(f1['ET']['07. Property'][2,:,0])
tmp = []
for i in range(NROW):
  tmp.append(nums[i*NCOL:(1+i)*NCOL])
et_dep = np.array(tmp)

print("rch:",rch[100,100])
print("et_surf:",et_surf[100,100])
print("et_rat:",et_rat[100,100])
print("et_dep:",et_dep[100,100])
```

#### è¯»å–f2é‡Œé¢çš„headå€¼ï¼Œä½œä¸ºæ°´å¤´ï¼Œchdå°±æ˜¯headçš„å€¼

```py
nums = list(f2['Datasets']['Head']['Values'][0])
tmp2 = []
for j in range(NLAY):
      tmp = []
      for i in range(NROW):
            tmp.append(nums[i*NCOL:(1+i)*NCOL])
      tmp2.append(tmp)
chd = np.array(tmp2)
chd.shape
# è¾“å‡ºæµ‹è¯•
# chd[0,98,29]
```

çœ‹çœ‹æ¨¡å‹ä¸­è¯»å–çš„æ°´å¤´å€¼æ˜¯å¦æ­£ç¡®ï¼Œç›´æ¥ç”¨matplotlibç»˜å›¾

```py
from matplotlib import pyplot as plt
from matplotlib import cm
import numpy.ma as npm

mask = chd < 0
arrmask = npm.array(chd, mask=mask)

plt.imshow(arrmask[3], cmap=cm.gray)
plt.colorbar()
plt.show()
```

### è¾“å…¥æ¨¡å‹åŸºæœ¬å‚æ•°

1. æ¨¡å‹å·¦ä¸‹è§’çš„åæ ‡

```py
xorigin = 498149
yorigin = 3594250
```

2. è¾“å…¥æ¨¡å‹è¡Œæ•°ã€åˆ—æ•°

nlayã€nrowã€ncolåœ¨å‰é¢è¯»å–h5çš„æ—¶å€™å·²ç»è¯»å–è¿‡

```py
# Discretization
import numpy as np
nper = 1                  # ç¨³å®šæµï¼Œå‘¨æœŸæ•°ä¸º 1
nlay = NLAY                  # å±‚æ•°
nrow = NROW                 # è¡Œæ•°
ncol = NCOL                 # åˆ—æ•°
delr = 49.84594               # å•ä½è¡Œé•¿ï¼Œåœ¨outæ–‡ä»¶å†…éƒ¨
delc = 49.82019               # å•ä½åˆ—é•¿ï¼Œåœ¨outæ–‡ä»¶å†…éƒ¨
# delz = 10.0               # å•ä½å±‚é«˜
Ly = delr * nrow
Lx = delc * ncol
top = top1                 # é¡¶éƒ¨é«˜ç¨‹
botm = bottoms
```

3. ç»™æ¨¡å‹å–ä¸ªåç§°ï¼Œæ¯”å¦‚1027ä»£è¡¨10æœˆ27æ—¥

```py
# Filename
sim_ws = 'simulation_1027_A'
sim_name = 'model'          # æ¨¡æ‹Ÿæ€»åç§°
gwfname = "gwf_" + sim_name # æ¸—æµæ¨¡å‹åç§°
gwtname = "gwt_" + sim_name # æº¶è´¨è¿ç§»æ¨¡å‹åç§°
```

4. æ¨¡å‹çš„å•ä½

```py
# Units
length_units = "meters"   # é•¿åº¦å•ä½
time_units = "days"       # æ—¶é—´å•ä½
```

5. è¾“å…¥å¼¥æ•£ç³»æ•°å’Œæ¸—é€ç³»æ•°

```py
# è®¾ç½®æº¶è´¨è¿ç§»æ¨¡å‹ä¸“é—¨å‚æ•°:
# GWT
porosity = 0.2
al = 20.0                    # çºµå‘å¼¥æ•£ç³»æ•°
trpt = 0.3; ath1 = al * trpt # æ¨ªå‘å¼¥æ•£ç³»æ•°
trpv = 0.3; atv = al * trpv  # å‚ç›´å¼¥æ•£ç³»æ•°

# è®¾ç½®æ¸—æµæ¨¡å‹ä¸“é—¨å‚æ•°:

# GWF
icelltype = [0, 0, 0, 0] # é¥±å’Œ or éé¥±å’Œ
k11 = HKs
# k22overk = HANI1[100,100]
# k33overk = VANI1[100,100]
k33 = k11
# icelltype = 0
# k11 = 0.5
```

6. è¾“å…¥æ—¶é—´ç¦»æ•£åŒ–å‚æ•°å’Œæ±‚è§£å™¨å‚æ•°

```py
# æ—¶é—´ç¦»æ•£åŒ–å‚æ•°:
# Temporal discretization
perlen = 100.0
nstp = 10
tsmult = 1.0
tdis_ds = []
tdis_ds.append((perlen, nstp, tsmult),)
print(tdis_ds)

# æ±‚è§£å™¨å‚æ•°ï¼š
# Solver parameters
nouter, ninner = 100, 300
hclose, rclose, relax = 1e-6, 1e-6, 1.0
```

7. åœ¨æ¨¡å‹ä¸­è®¾ç½®ä¸€å£äº•well ğŸ—‘ï¼ˆä¹Ÿå¯ä»¥ä¸åŠ âŒï¼‰

```py
# wel_spd äº•
qwell = 0     # æµé€Ÿ
cwell = 100.0 # æµ“åº¦
wel_loc = (2, 100, 100) # åˆ†åˆ«æ˜¯ï¼ˆå±‚å·ï¼Œè¡Œå·ï¼Œåˆ—å·ï¼‰
#               (k, i, j),  flow,  conc
wel_spd = {0: [[wel_loc, qwell, cwell]]}
```

9. åœ¨æ¨¡å‹ä¸­åŠ ä¸€ä¸ªæ²³æµ ğŸŒŠï¼ˆä¹Ÿå¯ä»¥ä¸åŠ âŒï¼‰

```py
# RIV
k_rivbott = 1 # æ²³åºŠåº•éƒ¨æ¸—é€ç³»æ•°ï¼Œm/d
thick_rivbott = 1 # æ²³åºŠæ²‰ç§¯ç‰©åšåº¦ï¼Œm
cond = k_rivbott * (delr) * (delc) / (thick_rivbott) # conductance, m2/d
r_bott = -2 # æ²³åº•é«˜ç¨‹, ä¹Ÿå¯ä»¥è®¾ä¸º 0
riv_stage = 2 # æ²³æµæ°´ä½ï¼Œ[1, 5, 2]
riv_sp_0 = [] # åº”åŠ›å‘¨æœŸ 0
# riv_sp_1 = [] # åº”åŠ›å‘¨æœŸ 1
# riv_sp_2 = [] # åº”åŠ›å‘¨æœŸ 2
for i in range(ncol): # æ²³æµæ°´ä½, conductance, æ²³åº•é«˜ç¨‹
    if idomain[0,100,i] == 1:
        riv_sp_0.append([0, 100, i, riv_stage, cond, r_bott])
        # riv_sp_1.append([0, 14, i, riv_stage[1], cond, r_bott])
        # riv_sp_2.append([0, 14, i, riv_stage[2], cond, r_bott])`
riv_spd = {0: riv_sp_0}
print("æ²³åº•é«˜ç¨‹:",r_bott)
print("æ²³æµæ°´ä½:",riv_stage)
print("æ²³åºŠåº•éƒ¨æ¸—é€ç³»æ•°:",k_rivbott,"m/d")
print("æ²³åºŠæ²‰ç§¯ç‰©åšåº¦:",thick_rivbott,"m")
print("conductance:",cond,"m2/d")
```

10. è¾¹ç•Œæ°´å¤´chdçš„æŒ‡å®š

è¦éå¸¸æ³¨æ„ï¼Œå®¹æ˜“ä¸æ”¶æ•›ï¼ï¼ï¼ï¼å•ŠğŸƒ

ä»¥ä¸‹2ä¸ªä»£ç å—åªéœ€è¦è·‘ä¸€ä¸ª

ä¸€ä¸ªä»£è¡¨ä¸œè¥¿2ä¾§æŒ‡å®šï¼Œä¸€ä¸ªä»£è¡¨å—åŒ—2ä¾§æŒ‡å®šï¼Œä¸éœ€è¦2ä¾§éƒ½æŒ‡å®š

```py
# chd_spd = []
# cnt = 0
# for k in np.arange(nlay): # å—åŒ—ä¸¤ä¾§åˆ†åˆ«æŒ‡å®š
#     for j in np.arange(ncol): # 
#         for i in np.arange(nrow):
#             if idomain[k][i][j] == 1:
#               chd_spd.append([(k, i, j), chd[k, i, j], 100.0]) #(l, r, c),head, conc
#               cnt += 1
#               break
#         for i in np.arange(nrow-1,-1,-1):
#             if idomain[k][i][j] == 1:
#               chd_spd.append([(k, i, j), chd[k, i, j], 100.0]) #(l, r, c),head, conc
#               cnt += 1
#               break
# chd_spd = {0: chd_spd}
# cnt
```

```py
chd_spd = []
list1 = []
list2 = []
cnt = 0
for k in np.arange(1): # ä¸œè¥¿ä¸¤ä¾§åˆ†åˆ«æŒ‡å®šï¼Œnlay
    for i in np.arange(nrow):
        for j in np.arange(ncol): # è¥¿
            if idomain[k][i][j] == 1:
              chd_spd.append([(k, i, j), chd[k, i, j], 100.0])  #(l, r, c),head, conc
              cnt += 1
              list1.append(chd[k, i, j]) 
              break
        for j in np.arange(ncol-1,-1,-1): # ä¸œ
            if idomain[k][i][j] == 1:
              chd_spd.append([(k, i, j), chd[k, i, j], 100.0])  #(l, r, c),head, conc
              list2.append(chd[k, i, j]) 
              break
chd_spd = {0: chd_spd}
cnt
```

### åˆ›å»ºä¸€ä¸ªå»ºæ¨¡çš„å‡½æ•°

```py
import flopy
def build_model():
    sim = flopy.mf6.MFSimulation(
        sim_name=sim_name, sim_ws=sim_ws, exe_name='/usr/local/lib/modflow/mf6'
    )
    print("sim_name:",sim_name)
    print("sim_ws:",sim_ws)

    # æ—¶é—´ç¦»æ•£åŒ–
    flopy.mf6.ModflowTdis(
        sim, nper=nper, perioddata=tdis_ds, time_units=time_units
    )

    # GWF
    gwf = flopy.mf6.ModflowGwf(
        sim,
        modelname=gwfname,
        save_flows=True,
        model_nam_file="{}.nam".format(gwfname),
    )
    print("gwfname:",gwfname)

    # æ¸—æµæ¨¡å‹æ±‚è§£å‚æ•°
    imsgwf = flopy.mf6.ModflowIms(
        sim,
        print_option="SUMMARY",
        outer_dvclose=hclose,
        outer_maximum=nouter,
        under_relaxation="NONE",
        inner_maximum=ninner,
        inner_dvclose=hclose,
        rcloserecord=rclose,
        linear_acceleration="CG",
        scaling_method="NONE",
        reordering_method="NONE",
        relaxation_factor=relax,
        filename="{}.ims".format(gwfname),
    )
    sim.register_ims_package(imsgwf, [gwf.name])

    # ç¦»æ•£åŒ–
    dis6 = flopy.mf6.ModflowGwfdis(
        gwf,
        length_units=length_units,
        xorigin=xorigin,
        yorigin=yorigin,
        nlay=nlay,
        nrow=nrow,
        ncol=ncol,
        delr=delr,
        delc=delc,
        top=top,
        botm=botm,
        idomain=idomain,
        filename="{}.dis".format(gwfname),
    )
    print("nlay:",nlay)
    print("nrow:",nrow)
    print("ncol:",ncol)
    print("delr:",delr)
    print("delc:",delc)
    print("top:",top)
    print("botm:",botm)

    # å«æ°´å±‚ç‰¹æ€§
    flopy.mf6.ModflowGwfnpf(
        gwf,
        save_flows=False,
        icelltype=icelltype,
        k=k11,
        # k22=1.0,
        # k22overk=k22overk,
        # k33overk=k33overk,
        k33=k33,
        save_specific_discharge=True,
        filename="{}.npf".format(gwfname),
    )
    print("icelltype:",icelltype)
    print("k11:",k11)
    print("k33:",k33)
    

    # åˆå§‹æ°´å¤´
    flopy.mf6.ModflowGwfic(
        gwf, strt=strt, filename="{}.ic".format(gwfname)
    )
    print("strt:",strt[0,100,100])
    print("strt:",strt[1,100,100])
    print("strt:",strt[2,100,100])
    print("strt:",strt[3,100,100])

    # æŒ‡å®šæ°´å¤´è¾¹ç•Œ
    flopy.mf6.ModflowGwfchd(
        gwf,
        maxbound=len(chd_spd),
        stress_period_data=chd_spd,
        save_flows=False,
        auxiliary="CONCENTRATION",
        pname="CHD-1",
        filename="{}.chd".format(gwfname),
    )
    print("chd_spd:",chd_spd[0][:10])
 
    flopy.mf6.ModflowGwfriv(
        gwf, 
        stress_period_data=riv_spd
    )

    # äº•è¾¹ç•Œ
    flopy.mf6.ModflowGwfwel(
        gwf,
        print_input=True,
        print_flows=True,
        stress_period_data=wel_spd,
        save_flows=False,
        auxiliary="CONCENTRATION",
        pname="WEL-1",
        filename="{}.wel".format(gwfname),
    )
    print("wel_spd:",wel_spd)

    # è¡¥ç»™recharge
    flopy.mf6.ModflowGwfrcha(
        gwf,
        recharge=rch,
        filename="{}.rch".format(gwfname),
    )
    print("rch:",rch[100,100])

    # è’¸å‘
    flopy.mf6.ModflowGwfevta(
        gwf,
        surface=et_surf,
        rate=et_rat,
        depth=et_dep,
        filename="{}.evt".format(gwfname),
    )
    print("et_surf:",et_surf[100,100])
    print("et_rat:",et_rat[100,100])
    print("et_dep:",et_dep[100,100])

    # è¾“å‡ºæ§åˆ¶
    flopy.mf6.ModflowGwfoc(
        gwf,
        head_filerecord="{}.hds".format(gwfname),
        budget_filerecord="{}.bud".format(gwfname),
        headprintrecord=[
            ("COLUMNS", 100, "WIDTH", 150, "DIGITS", 6, "GENERAL")
        ],
        saverecord=[("HEAD", "ALL"), ("BUDGET", "ALL")],
        printrecord=[("HEAD", "ALL"), ("BUDGET", "ALL")],
    )

    # GWT
    gwt = flopy.mf6.ModflowGwt(
        sim,
        modelname=gwtname,
        save_flows=True,
        model_nam_file="{}.nam".format(gwtname),
    )

    # æº¶è´¨è¿ç§»æ¨¡å‹æ±‚è§£å‚æ•°
    imsgwt = flopy.mf6.ModflowIms(
        sim,
        print_option="SUMMARY",
        outer_dvclose=hclose,
        outer_maximum=nouter,
        under_relaxation="NONE",
        inner_maximum=ninner,
        inner_dvclose=hclose,
        rcloserecord=rclose,
        linear_acceleration="BICGSTAB",
        scaling_method="NONE",
        reordering_method="NONE",
        relaxation_factor=relax,
        filename="{}.ims".format(gwtname),
    )
    sim.register_ims_package(imsgwt, [gwt.name])

    # ç¦»æ•£åŒ–
    flopy.mf6.ModflowGwtdis(
        gwt,
        nlay=nlay,
        nrow=nrow,
        ncol=ncol,
        delr=delr,
        delc=delc,
        top=top,
        botm=botm,
        idomain=idomain,
        filename="{}.dis".format(gwtname),
    )

    # åˆå§‹æµ“åº¦
    flopy.mf6.ModflowGwtic(
        gwt, strt=sconc, filename="{}.ic".format(gwtname)
    )

    # å¯¹æµ
    flopy.mf6.ModflowGwtadv(
        gwt, scheme="UPSTREAM", filename="{}.adv".format(gwtname)
    )

    # å¼¥æ•£
    flopy.mf6.ModflowGwtdsp(
        gwt,
        alh=al,
        ath1=ath1,
        atv=atv,
        filename="{}.dsp".format(gwtname),
    )

    # åŒ–å­¦ååº” (ç­‰åŒäº MT3DMS çš„ reaction)
    flopy.mf6.ModflowGwtmst(
        gwt,
        porosity=porosity,
        first_order_decay=False,
        decay=None,
        decay_sorbed=None,
        sorption=None,
        bulk_density=None,
        distcoef=None,
        filename="{}.mst".format(gwtname),
    )

    # æºæ±‡é¡¹
    sourcerecarray = [
        ("WEL-1", "AUX", "CONCENTRATION"),
        ("CHD-1", "AUX", "CONCENTRATION"),
    ]
    flopy.mf6.ModflowGwtssm(
        gwt, sources=sourcerecarray, filename="{}.ssm".format(gwtname)
    )

    # è¾“å‡ºæ§åˆ¶
    flopy.mf6.ModflowGwtoc(
        gwt,
        budget_filerecord="{}.cbc".format(gwtname),
        concentration_filerecord="{}.ucn".format(gwtname),
        concentrationprintrecord=[
            ("COLUMNS", 10, "WIDTH", 15, "DIGITS", 6, "GENERAL")
        ],
        saverecord=[("CONCENTRATION", "ALL"), ("BUDGET", "ALL")],
        printrecord=[("CONCENTRATION", "ALL"), ("BUDGET", "ALL")],
    )

    # GWF å’Œ GWT ä¹‹é—´çš„äº¤æ¢
    flopy.mf6.ModflowGwfgwt(
        sim,
        exgtype="GWF6-GWT6",
        exgmnamea=gwfname,
        exgmnameb=gwtname,
        filename="{}.gwfgwt".format(sim_name),
    )
    return sim, gwf, gwt, dis6
```

### åˆ›å»ºä¸€ä¸ªç»˜åˆ¶ç»“æœçš„å‡½æ•°

```py
import matplotlib.pyplot as plt

def plot_results(model, result):
    fig = plt.figure(figsize = (14, 6))
    ax = fig.add_subplot(1, 1, 1)
    pmv = flopy.plot.PlotMapView(model = model, ax = ax, layer = 0)
    pmv.plot_grid(ax = ax, color = ".5", alpha = 0.2) # ç»˜åˆ¶ç½‘æ ¼
    
    # ç½‘æ ¼å¡«å……é¢œè‰²
    plot_array = pmv.plot_array(result, masked_values = [1e30], cmap = 'bwr')
    plt.colorbar(plot_array)
    riv = pmv.plot_bc("RIV", alpha = 0.5)
    qm = pmv.plot_bc("CHD", alpha = 0.5)
    
    # ç»˜åˆ¶ç­‰å€¼çº¿
    plot_contour_array = pmv.contour_array(result, masked_values = [1e30], cmap = "brg", linestyles="--")
    plt.clabel(plot_contour_array, fmt = r'%.2f') # ç»˜åˆ¶ç­‰å€¼çº¿ä¸Šæ–‡æœ¬æ ‡æ³¨
    # plt.colorbar(plot_contour_array)              # ç­‰å€¼çº¿å›¾ä¾‹
    
    pmv.plot_bc(package = model.get_package("WEL-1"), color = 'green')
    pmv.plot_inactive(ibound = model.modelgrid.idomain, color_noflow = 'black')
    
    # ç»˜åˆ¶æ°´æµçš„æ–¹å‘ (ç²‰çº¢è‰²ç®­å¤´)
    spdis = gwf.oc.output.budget().get_data(text = 'DATA-SPDIS')[0]
    qx, qy, qz = flopy.utils.postprocessing.get_specific_discharge(spdis, gwf)
    pmv.plot_vector(qx, qy, normalize = True, istep = 10, jstep = 10, color = "pink")
```


### å¼€å§‹è·‘æ¨¡å‹

```py
sim, gwf, gwt, dis6 = build_model()

sim.write_simulation(silent = True)

success, buff = sim.run_simulation(silent = True)
if not success:
    raise Exception("MODFLOW 6 did not terminate normally.")
```

### è¯»å‡ºæ¨¡å‹çš„ç»“æœ

```py
import matplotlib.pyplot as plt

head = gwf.oc.output.head().get_alldata()
concentration = gwt.oc.output.concentration().get_alldata()
print("head.shape:", head.shape)
print("concentration.shape:", concentration.shape)

# head.shape: (30, 4, 213, 283)
# concentration.shape: (30, 4, 213, 283)
```

```py
plot_results(model = gwf, result = concentration[9,0])
```

```py
plot_results(model = gwf, result = concentration[29,0])
```

## å‡å¦‚æ¨¡å‹éœ€è¦â€œæº¯æºâ€éœ€è¦ç”¨åˆ°modpath

ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºç²’å­ç¾¤particlegroups

```py
# create particles
grid = gwf.modelgrid
partlocs = []
partids = []
for i in range(0,grid.nrow,10):
      for j in range(0,grid.ncol,10):
            if idomain[0,i,j] == 1:
                partlocs.append((0, i, j))
                partids.append(i*grid.ncol + j)
part0 = flopy.modpath.ParticleData(partlocs, structured=True, particleids=partids)
pg0 = flopy.modpath.ParticleGroup(
    particlegroupname="PG1", particledata=part0, filename="ex01a.sloc"
)

v = [(0,), (400,)]
pids = [1, 2]  # [1000, 1001]
part1 = flopy.modpath.ParticleData(v, structured=False, drape=1, particleids=pids)
pg1 = flopy.modpath.ParticleGroup(
    particlegroupname="PG2", particledata=part1, filename="ex01a.pg2.sloc"
)

particlegroups = [pg0, pg1]
```

ç¬¬äºŒæ­¥ï¼šå°†particlegroupsæ”¾åˆ°æ¨¡å‹ä¸­è·‘

```py
mp_namea = sim_name + "a_mp"
model_ws = sim_ws
# create modpath files
mp = flopy.modpath.Modpath7(
    modelname=mp_namea, flowmodel=gwf, exe_name="/usr/local/lib/modflow/mp7", model_ws=model_ws
)
flopy.modpath.Modpath7Bas(mp, porosity=porosity)

flopy.modpath.Modpath7Sim(
    mp,
    simulationtype="combined",
    trackingdirection="backward", # é‡è¦
    weaksinkoption="pass_through",
    weaksourceoption="pass_through",
    referencetime=0.0,
    stoptimeoption="specified", # "extend"
    stoptime=365.0*20,
    zonedataoption="on",
    stopzone=2,
    zones=zone3,
    timepointdata=[100, 365.0], # the number of time points (timepointcount)
    particlegroups=particlegroups, # ç²’å­ç¾¤å‚æ•°
)

# flopy.modpath.Modpath7Sim(
#     mp,
#     simulationtype="combined",
#     trackingdirection="backward", # é‡è¦
#     weaksinkoption="pass_through",
#     weaksourceoption="pass_through",
#     referencetime=0.0,
#     stoptimeoption="specified", # "extend"
#     stoptime=500000.0,
#     zonedataoption="on",
#     stopzone=2,
#     zones=zone3,
#     timepointdata=[500, 1000.0], # the number of time points (timepointcount)
#     particlegroups=particlegroups, # ç²’å­ç¾¤å‚æ•°
# )

# flopy.modpath.Modpath7Sim(
#     mp,
#     simulationtype="combined",
#     trackingdirection="backward", # é‡è¦
#     weaksinkoption="pass_through",
#     weaksourceoption="pass_through",
#     referencetime=0.0,
#     stoptimeoption="extend", # "extend"
#     zonedataoption="on",
#     stopzone=2,
#     zones=zone3,
#     timepointdata=[500, 1000.0],
#     particlegroups=particlegroups, # ç²’å­ç¾¤å‚æ•°
# )

# flopy.modpath.Modpath7Sim(
#     mp,
#     simulationtype="combined",
#     trackingdirection="forward",
#     weaksinkoption="pass_through",
#     weaksourceoption="pass_through",
#     budgetoutputoption="summary",
#     budgetcellnumbers=[1049, 1259],
#     traceparticledata=[1, 1000],
#     referencetime=[0, 0, 0.0],
#     stoptimeoption="extend",
#     timepointdata=[500, 1000.0],
#     zonedataoption="on",
#     stopzone=2,
#     zones=zone3,
#     particlegroups=particlegroups,
# )

# write modpath datasets
mp.write_input()

```

ç¬¬ä¸‰æ­¥ï¼šè·‘æ¨¡å‹

```py
# run modpath
mp.run_model()
```

ç¬¬å››æ­¥ï¼šè·å–æ¨¡å‹æ•°æ®å¹¶ç»˜å›¾

```py

fpth = os.path.join(model_ws, mp_namea + ".mppth")
p = flopy.utils.PathlineFile(fpth)
p0 = p.get_alldata()
fpth = os.path.join(model_ws, mp_namea + ".timeseries")
ts = flopy.utils.TimeseriesFile(fpth)
ts0 = ts.get_alldata()

# ç”»å‡ºendpoint
fpth = os.path.join(model_ws, mp_namea + ".mpend")
e = flopy.utils.EndpointFile(fpth)
e0 = e.get_alldata()

import matplotlib as mpl
fig = plt.figure(figsize=(13, 13), constrained_layout=True)
ax = fig.add_subplot(1, 1, 1, aspect="equal")
mm = flopy.plot.PlotMapView(modelgrid=gwf.modelgrid, ax=ax)
ax.set_xlim(0, Lx)
ax.set_ylim(0, Ly)
cmap = mpl.colors.ListedColormap(
    [
        "r",
        "g",
    ]
)
pmv = flopy.plot.PlotMapView(model = gwf, ax = ax, layer = 0)
# plot_array = pmv.plot_array(head[9,0], masked_values = [1e30], cmap = 'bwr')
# plt.colorbar(plot_array)
v = mm.plot_array(idomain[0], cmap=cmap, edgecolor="gray")
mm.plot_endpoint(e0, direction="ending", colorbar=True, shrink=0.5);
```

ç¬¬äº”æ­¥ï¼šç»˜åˆ¶ç¬¬äºŒå¼ å›¾


## åæ ‡è½¬åŒ–

```py
from pyproj import Proj,transform
import math

def WGS84_CGCS2000(lon,lat,degree_type,is_zone_number):

    '''
    :param lon: ç»åº¦
    :param lat: çº¬åº¦
    :param degree_type:3åº¦å¸¦æˆ–è€…6åº¦å¸¦
    :param is_zone_number: ç”Ÿæˆåæ ‡æ˜¯å¦åŒ…å«å¸¦å·
    :return:
    '''

    if int(lon)<75 or int(lon)>135:
        print('è¯¥åŒºåŸŸä¸åœ¨ä¸­å›½å¢ƒå†…')
    else:
        if degree_type==3:
            if is_zone_number==True:
                zone=math.floor( (lon-1.5)/3 )+1
                Epsg_test='45{0}'.format(str(zone-12) )
                p1 = Proj(init='epsg:4326')
                p2 = Proj(init='epsg:{0}'.format(Epsg_test))
                x, y = p1(lon,lat)
                x_prj, y_prj = transform(p1, p2, x, y)
                x_prj=int(x_prj)
                y_prj=int(y_prj)

            elif is_zone_number==False:
                zone=math.floor( (lon-1.5)/3 )+1
                Epsg_test = '45{0}'.format(str(zone+9))
                p1 = Proj(init='epsg:4326')
                p2 = Proj(init='epsg:{0}'.format(Epsg_test))
                x, y = p1(lon,lat)
                x_prj, y_prj = transform(p1, p2, x, y)
                x_prj=int(x_prj)
                y_prj=int(y_prj)

        elif degree_type==6:

            if is_zone_number==True:
                zone=math.floor(lon/6)+1
                epsg=str(4490+zone-12)
                p1 = Proj(init='epsg:4326')
                p2 = Proj(init='epsg:{0}'.format(epsg))
                x, y = p1(lon,lat)
                x_prj, y_prj = transform(p1, p2, x, y)
                x_prj=int(x_prj)
                y_prj=int(y_prj)

            elif is_zone_number==False:

                zone = math.floor(lon / 6) + 1
                epsg=4500+zone-11
                p1 = Proj(init='epsg:4326')
                p2 = Proj(init='epsg:{0}'.format(epsg))
                x, y = p1(lon,lat)
                x_prj, y_prj = transform(p1, p2, x, y)
                x_prj=int(x_prj)
                y_prj=int(y_prj)

    return x_prj,y_prj

def CGCS2000_WGS84(X,Y):

    p = Proj(init='epsg:4528')
    lon,lat = p(X,Y,inverse=True)
    lon=round(lon,6)
    lat=round(lat,6)
    return lon,lat

if __name__=='__main__':
    X_DIFF = 40094019 
    Y_DIFF = 368
    x_2000, y_2000 = WGS84_CGCS2000(121.049864464,32.551416489, 3, is_zone_number=True)
    print("å¯¹åº”çš„ç½‘æ ¼åæ ‡:", x_2000 - X_DIFF, y_2000 - Y_DIFF)
    # IDä¸º0çš„åæ ‡å€¼
    x0 = 498149
    y0 = 3604810
    x_WGS84, y_WGS84 = CGCS2000_WGS84(x0 + X_DIFF, y0 + Y_DIFF)
    print("å¯¹åº”çš„WGSåæ ‡:", x_WGS84, y_WGS84)

    # print(CGCS2000_WGS84(x_2000,y_2000))
```

### å‡å¦‚æ¨¡å‹ä¸­å¢åŠ ä¸€ä¸ªæ±¡æŸ“æº

userInputè¾“å…¥æ±¡æŸ“æºçš„ç»çº¬åº¦

```py
userInput = [121.049864464, 32.551416489]
x2000tmp, y2000tmp = WGS84_CGCS2000(userInput[0],userInput[1], 3, is_zone_number=True)
pollutionX = x2000tmp - X_DIFF
pollutionY = y2000tmp - Y_DIFF
print("å¯¹åº”çš„ç½‘æ ¼åæ ‡:", pollutionX, pollutionY)
```

### å¼€å§‹è·‘æ¨¡å‹

```py
# æ—¶é—´ç¦»æ•£åŒ–å‚æ•°:
# Temporal discretization
# æ—¶é—´ç¦»æ•£åŒ–å‚æ•°:
nper = 3
tdis_ds = [(100.0, 10, 1.0), (900.0, 10, 1.0), (9000.0, 10, 1.0)]
print(tdis_ds)

# Filename
sim_ws = 'simulation_1026_pollution'
sim_name = 'pollution'          # æ¨¡æ‹Ÿæ€»åç§°
gwfname = "gwf_" + sim_name # æ¸—æµæ¨¡å‹åç§°
gwtname = "gwt_" + sim_name # æº¶è´¨è¿ç§»æ¨¡å‹åç§°


sim, gwf, gwt, dis6 = build_model()
sim.write_simulation(silent = True)

success, buff = sim.run_simulation(silent = True)
if not success:
    raise Exception("MODFLOW 6 did not terminate normally.")

```

### è·å–æ¨¡å‹ä¸­çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯

ç½‘æ ¼ç‚¹çš„åæ ‡

```py
xvertice = gwf.modelgrid.xvertices
yvertice = gwf.modelgrid.yvertices
x0 = xvertice[0,0]
y0 = yvertice[0,0]
print("x0:", x0)
print("y0:", y0)
```

è¾“å‡ºå¯¹åº”ç½‘æ ¼çš„åºå·

```py
pollutionC = int((pollutionX - x0) // delc)
pollutionR = int((y0 - pollutionY) // delr)

print("å¯¹åº”çš„ç½‘æ ¼åºå·:", pollutionC, pollutionR)
```

å‡è®¾æ±¡æŸ“ç‰©åœ¨äº•å››å‘¨9ä¸ªç½‘æ ¼ç‚¹ï¼š

```py
# è¾¹ç•Œæ¡ä»¶: # Boundary conditions
# wel_spd äº•
wel_spd = []
qwell = 0.5
cwell = 100.0
laytmp = 2
directions = [[-1,-1],[-1,0],[-1,1], \
              [0,-1],[0,0],[0,1], \
              [1,-1],[1,0],[1,1]]
for dx, dy in directions:
      wel_loc = (laytmp, pollutionR + dx, pollutionC + dy)
      wel_spd.append([wel_loc, qwell, cwell])
wel_spd = {0: wel_spd}
wel_spd
```

## åœ¨ä¸€ä¸ªç›‘æµ‹ç‚¹é™„è¿‘è¿›è¡Œæº¯æº

### ç›‘æµ‹ç‚¹çš„ç»çº¬åº¦ä¸ºuserInput

```py
userInput = [121.049864464, 32.551416489]
x2000tmp, y2000tmp = WGS84_CGCS2000(userInput[0],userInput[1], 3, is_zone_number=True)
monitorX = x2000tmp - X_DIFF
monitorY = y2000tmp - Y_DIFF
x0 = xvertice[0,0]
y0 = yvertice[0,0]
monitorC = int((monitorX - x0) // delc)
monitorR = int((y0 - monitorY) // delr)
laytmp = 1
nodew = (laytmp, monitorR, monitorC)
```

```py
# Define names for the MODPATH 7 simulations
mp_namea = sim_name + "a_mp3"
mp_nameb = sim_name + "b_mp3"
```

### åˆ›å»ºç²’å­ç¾¤ï¼Œå¹¶è¿›è¡Œè®¡ç®—

```py
multi = 1 # 

pcoord = np.array(
    [
        [0.000 * multi, 0.125 * multi, 0.500],
        [0.000 * multi, 0.375 * multi, 0.500],
        [0.000 * multi, 0.625 * multi, 0.500],
        [0.000 * multi, 0.875 * multi, 0.500],
        [1.000 * multi, 0.125 * multi, 0.500],
        [1.000 * multi, 0.375 * multi, 0.500],
        [1.000 * multi, 0.625 * multi, 0.500],
        [1.000 * multi, 0.875 * multi, 0.500],
        [0.125 * multi, 0.000 * multi, 0.500],
        [0.375 * multi, 0.000 * multi, 0.500],
        [0.625 * multi, 0.000 * multi, 0.500],
        [0.875 * multi, 0.000 * multi, 0.500],
        [0.125 * multi, 1.000 * multi, 0.500],
        [0.375 * multi, 1.000 * multi, 0.500],
        [0.625 * multi, 1.000 * multi, 0.500],
        [0.875 * multi, 1.000 * multi, 0.500],
    ]
)
print("pcoord.shape[0]:",pcoord.shape[0])
# pcoord.shape[0]

plocs = [nodew for i in range(pcoord.shape[0])]
print("plocs:", plocs)
# create particle data
pa = flopy.modpath.ParticleData(
    plocs,
    structured=True,
    localx=pcoord[:, 0],
    localy=pcoord[:, 1],
    localz=pcoord[:, 2],
    drape=0,
)
print("pcoord[:, 0]:",pcoord[:, 0])
print("pcoord[:, 1]:",pcoord[:, 1])
print("pcoord[:, 2]:",pcoord[:, 2])

# create backward particle group
fpth = mp_namea + ".sloc"
pga = flopy.modpath.ParticleGroup(
    particlegroupname="BACKWARD1", particledata=pa, filename=fpth
)

model_ws = sim_ws
# create modpath files
mp = flopy.modpath.Modpath7(
    modelname=mp_namea, flowmodel=gwf, exe_name="/usr/local/lib/modflow/mp7", model_ws=model_ws
)
flopy.modpath.Modpath7Bas(mp, porosity=porosity)
flopy.modpath.Modpath7Sim(
    mp,
    simulationtype="combined",
    trackingdirection="backward",
    weaksinkoption="pass_through",
    weaksourceoption="pass_through",
    referencetime=0.0,
    stoptimeoption="extend",
    timepointdata=[500, 1000.0],
    particlegroups=pga,
)

# write modpath datasets
mp.write_input()
```

### è·‘æ¨¡å‹ï¼Œè·å–æ•°æ®ï¼Œå¹¶ç»˜å›¾

```py
# run modpath
mp.run_model()

fpth = os.path.join(model_ws, mp_namea + ".mppth")
p = flopy.utils.PathlineFile(fpth)
p0 = p.get_alldata()
fpth = os.path.join(model_ws, mp_namea + ".timeseries")
ts = flopy.utils.TimeseriesFile(fpth)
ts0 = ts.get_alldata()

# ç”»å‡ºendpoint
fpth = os.path.join(model_ws, mp_namea + ".mpend")
e = flopy.utils.EndpointFile(fpth)
e0 = e.get_alldata()

import matplotlib as mpl
fig = plt.figure(figsize=(13, 13), constrained_layout=True)
ax = fig.add_subplot(1, 1, 1, aspect="equal")
mm = flopy.plot.PlotMapView(modelgrid=gwf.modelgrid, ax=ax)
ax.set_xlim(0, Lx)
ax.set_ylim(0, Ly)
cmap = mpl.colors.ListedColormap(
    [
        "r",
        "g",
    ]
)
pmv = flopy.plot.PlotMapView(model = gwf, ax = ax, layer = 0)
plot_array = pmv.plot_array(head[9,0], masked_values = [1e30], cmap = 'bwr')
# plt.colorbar(plot_array)
v = mm.plot_array(idomain[0], cmap=cmap, edgecolor="gray")
mm.plot_endpoint(e0, direction="ending", colorbar=True, shrink=0.5);
```

### ç»˜åˆ¶ç¬¬äºŒå¼ å›¾

```py
import matplotlib as mpl
fig = plt.figure(figsize=(8, 8), constrained_layout=True)
ax = fig.add_subplot(1, 1, 1, aspect="equal")
mm = flopy.plot.PlotMapView(modelgrid=gwf.modelgrid, ax=ax)
# pmv = flopy.plot.PlotMapView(model = gwf, ax = ax, layer = 0)
# mm.plot_grid(ax = ax, color = ".5", alpha = 0.2) # ç»˜åˆ¶ç½‘æ ¼
ax.set_xlim(0, Lx)
ax.set_ylim(0, Ly)
cmap = mpl.colors.ListedColormap(
    [
        "r",
        "g",
    ]
)
v = mm.plot_array(gwf.modelgrid.idomain, cmap=cmap, edgecolor="white")
mm.plot_pathline(p0, layer="all", color="blue", lw=0.75)
colors = ["green", "orange", "red","blue"]
# ç»˜åˆ¶å„ä¸ªé¢œè‰²çš„ç‚¹
# for k in range(nlay):
#     mm.plot_timeseries(ts0, layer=k, marker="o", lw=0, color=colors[k]);
mm.plot_timeseries(ts0, layer=0, marker="o", lw=0, color=colors[0])

# ç»˜åˆ¶ç­‰å€¼çº¿
plot_contour_array = mm.contour_array(concentration[9,0], masked_values = [1e30], cmap = "brg", linestyles="--")
plt.clabel(plot_contour_array, fmt = r'%.2f') # ç»˜åˆ¶ç­‰å€¼çº¿ä¸Šæ–‡æœ¬æ ‡æ³¨
# plt.colorbar(plot_contour_array)              # ç­‰å€¼çº¿å›¾ä¾‹

mm.plot_bc(package = gwf.get_package("WEL-1"), color = 'green')
mm.plot_inactive(ibound = gwf.modelgrid.idomain, color_noflow = 'black')


```

## æ§åˆ¶ç›‘æ§ç‚¹çš„ä½ç½®ï¼Œç«¯ç‚¹ï¼Œå°½é‡ä¿è¯æ˜¯ç›´çº¿

å…ˆç¡®å®šç›‘æ§ç‚¹çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ä»GMSä¸­ï¼Œç¡®å®šç›‘æ§ç‚¹çš„ç½‘æ ¼åæ ‡

```py
è¿™é‡Œçš„getHeadï¼Œç”¨çš„æ˜¯æ¨¡å‹ä¸­è¯»å–çš„å€¼ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œåº”ç”¨ä¼ æ„Ÿå™¨è¯»å–åˆ°çš„å®æµ‹å€¼
def getHead(tmpi, tmpj):
    return head[29, 0, tmpi-1, tmpj-1] 
```

### å·¦ä¾§è¾¹ç•Œæ‹Ÿåˆ

```py
x = [11, 19, 27, 37, 45, 72, 87, 109, 115]
y = [getHead(11, 112), getHead(19, 104), getHead(27, 95), getHead(37, 84), getHead(45, 75), getHead(72, 49), getHead(87, 38), getHead(109, 21), getHead(115, 15)]
z1 = np.polyfit(x, y, 4) #ç”¨3æ¬¡å¤šé¡¹å¼æ‹Ÿåˆï¼Œè¾“å‡ºç³»æ•°ä»é«˜åˆ°0
funcLeft1 = np.poly1d(z1) #ä½¿ç”¨æ¬¡æ•°åˆæˆå¤šé¡¹å¼
y_pre = funcLeft1(x)

plt.plot(x,y,'.')
plt.plot(x,y_pre)
plt.show()
```

```py
x = [115, 118, 133, 154, 202]
# y = [getHead(115, 15), getHead(115, 15), getHead(115, 15), getHead(115, 15), getHead(115, 15)]
y = [getHead(115, 15), getHead(118, 37), getHead(133, 71), getHead(154, 120), getHead(202, 215)]
z1 = np.polyfit(x, y, 4) #ç”¨3æ¬¡å¤šé¡¹å¼æ‹Ÿåˆï¼Œè¾“å‡ºç³»æ•°ä»é«˜åˆ°0
funcLeft2 = np.poly1d(z1) #ä½¿ç”¨æ¬¡æ•°åˆæˆå¤šé¡¹å¼
y_pre = funcLeft2(x)

plt.plot(x,y,'.')
plt.plot(x,y_pre)
plt.show()
```

### å³ä¾§è¾¹ç•Œæ‹Ÿåˆ

```py
x = [11, 14, 20, 30, 46, 60]
y = [getHead(11, 112), getHead(14, 117), getHead(20, 119), getHead(30, 136), getHead(46, 195), getHead(60, 247)]
z1 = np.polyfit(x, y, 6) #ç”¨3æ¬¡å¤šé¡¹å¼æ‹Ÿåˆï¼Œè¾“å‡ºç³»æ•°ä»é«˜åˆ°0
funcRight1 = np.poly1d(z1) #ä½¿ç”¨æ¬¡æ•°åˆæˆå¤šé¡¹å¼
y_pre = funcRight1(x)

plt.plot(x,y,'.')
plt.plot(x,y_pre)
plt.show()
```

```py
x = [60, 119, 138, 145, 154, 162, 172, 187, 202]
y = [getHead(60, 247), getHead(119, 270), getHead(138, 262), getHead(145, 252), getHead(154, 241), getHead(162, 232), getHead(172, 228), getHead(187, 221), getHead(202, 215)]
z2 = np.polyfit(x, y, 6) #ç”¨3æ¬¡å¤šé¡¹å¼æ‹Ÿåˆï¼Œè¾“å‡ºç³»æ•°ä»é«˜åˆ°0
funcRight2 = np.poly1d(z2) #ä½¿ç”¨æ¬¡æ•°åˆæˆå¤šé¡¹å¼
y_pre = funcRight2(x)

plt.plot(x,y,'.')
plt.plot(x,y_pre)
plt.show()
```

### åˆ›å»ºæ–°çš„æ¨¡å‹

```py
# Filename
sim_ws = 'simulation_1028_B'
sim_name = 'model'          # æ¨¡æ‹Ÿæ€»åç§°
gwfname = "gwf_" + sim_name # æ¸—æµæ¨¡å‹åç§°
gwtname = "gwt_" + sim_name # æº¶è´¨è¿ç§»æ¨¡å‹åç§°

# è¾¹ç•Œæ¡ä»¶: # Boundary conditions
# wel_spd äº•
wel_spd = []
qwell = 0
cwell = 100.0
laytmp = 2
directions = [[-1,-1],[-1,0],[-1,1], \
              [0,-1],[0,0],[0,1], \
              [1,-1],[1,0],[1,1]]
for dx, dy in directions:
      wel_loc = (laytmp, pollutionR + dx, pollutionC + dy)
      wel_spd.append([wel_loc, qwell, cwell])
wel_spd = {0: wel_spd}

# æ—¶é—´ç¦»æ•£åŒ–å‚æ•°:
# Temporal discretization
# æ—¶é—´ç¦»æ•£åŒ–å‚æ•°:
nper = 1
tdis_ds = [(100.0, 10, 1.0)]

chd_spd = []
cnt = 0

for k in np.arange(nlay): 
      for i in np.arange(nrow):
            for j in np.arange(ncol): # è¥¿è¾¹
                  if idomain[k][i][j] == 1: # i <= 103 å¯ä»¥æŠŠsouthè¿‡æ»¤æ‰
                        # chd_spd.append([(k, i, j), funcLeft3(i), 100.0])  #(l, r, c),head, conc
                        # cnt += 1
                        # break
                        if i < 115:
                              chd_spd.append([(k, i, j), funcLeft1(i+1), 100.0])  #(l, r, c),head, conc
                              cnt += 1
                              break
                        else:
                              chd_spd.append([(k, i, j), funcLeft2(i+1), 100.0])  #(l, r, c),head, conc
                              cnt += 1
                              break
            for j in np.arange(ncol-1,-1,-1):  # ä¸œè¾¹
                  if idomain[k][i][j] == 1: # i >= 84 å¯ä»¥æŠŠnorthè¿‡æ»¤æ‰
                        # chd_spd.append([(k, i, j), funcRight3(i), 100.0])  #(l, r, c),head, conc
                        # cnt += 1
                        # break
                        if i < 60:
                              chd_spd.append([(k, i, j), funcRight1(i+1), 100.0])  #(l, r, c),head, conc
                              cnt += 1
                              break
                        else:
                              chd_spd.append([(k, i, j), funcRight2(i+1), 100.0])  #(l, r, c),head, conc
                              cnt += 1
                              break

# for k in np.arange(4): # ä¸œè¥¿ä¸¤ä¾§åˆ†åˆ«æŒ‡å®šï¼Œnlay
#       for i in np.arange(nrow):
#             for j in np.arange(ncol): # è¥¿
#                   if idomain[k][i][j] == 1:
#                         chd_spd.append([(k, i, j), chd[k, i, j], 100.0])  #(l, r, c),head, conc
#                         break
#             for j in np.arange(ncol-1,-1,-1): # ä¸œ
#                   if idomain[k][i][j] == 1:
#                         chd_spd.append([(k, i, j), chd[k, i, j], 100.0])  #(l, r, c),head, conc
#                         break
chd_spd_dic = {0: chd_spd}
cnt
```

### æ¨¡å‹å†è·‘ä¸€é

```py


# chd_spd = []
# cnt = 0
# for k in np.arange(1): 
#     for j in np.arange(ncol): 
#         for i in np.arange(nrow): # åŒ—è¾¹
#             if idomain[k][i][j] == 1 and j >= 125: # j >= 125 å¯ä»¥æŠŠwestè¿‡æ»¤æ‰
#               chd_spd.append([(k, i, j), funcSouth_j(j), 100.0]) #(l, r, c),head, conc
#               cnt += 1
#               break
#         for i in np.arange(nrow-1,-1,-1): # å—è¾¹
#             if idomain[k][i][j] == 1 and j <= 185: # j <= 185 å¯ä»¥æŠŠeastè¿‡æ»¤æ‰
#               chd_spd.append([(k, i, j), funcNorth_j(j), 100.0]) #(l, r, c),head, conc
#               cnt += 1
#               break
# chd_spd = {0: chd_spd}
# cnt

# RIV
# riv_sp_0 = [] # åº”åŠ›å‘¨æœŸ 0
# riv_spd = {0: riv_sp_0}

import flopy
def build_model():
    sim = flopy.mf6.MFSimulation(
        sim_name=sim_name, sim_ws=sim_ws, exe_name='/usr/local/lib/modflow/mf6'
    )
    print("sim_name:",sim_name)
    print("sim_ws:",sim_ws)

    # æ—¶é—´ç¦»æ•£åŒ–
    flopy.mf6.ModflowTdis(
        sim, nper=nper, perioddata=tdis_ds, time_units=time_units
    )

    # GWF
    gwf = flopy.mf6.ModflowGwf(
        sim,
        modelname=gwfname,
        save_flows=True,
        model_nam_file="{}.nam".format(gwfname),
    )
    print("gwfname:",gwfname)

    # æ¸—æµæ¨¡å‹æ±‚è§£å‚æ•°
    imsgwf = flopy.mf6.ModflowIms(
        sim,
        print_option="SUMMARY",
        outer_dvclose=hclose,
        outer_maximum=nouter,
        under_relaxation="NONE",
        inner_maximum=ninner,
        inner_dvclose=hclose,
        rcloserecord=rclose,
        linear_acceleration="CG",
        scaling_method="NONE",
        reordering_method="NONE",
        relaxation_factor=relax,
        filename="{}.ims".format(gwfname),
    )
    sim.register_ims_package(imsgwf, [gwf.name])

    # ç¦»æ•£åŒ–
    dis6 = flopy.mf6.ModflowGwfdis(
        gwf,
        length_units=length_units,
        xorigin=xorigin,
        yorigin=yorigin,
        nlay=nlay,
        nrow=nrow,
        ncol=ncol,
        delr=delr,
        delc=delc,
        top=top,
        botm=botm,
        idomain=idomain,
        filename="{}.dis".format(gwfname),
    )
    print("nlay:",nlay)
    print("nrow:",nrow)
    print("ncol:",ncol)
    print("delr:",delr)
    print("delc:",delc)
    print("top:",top)
    print("botm:",botm)

    # å«æ°´å±‚ç‰¹æ€§
    flopy.mf6.ModflowGwfnpf(
        gwf,
        save_flows=False,
        icelltype=icelltype,
        k=k11,
        # k22=1.0,
        # k22overk=k22overk,
        # k33overk=k33overk,
        k33=k33,
        save_specific_discharge=True,
        filename="{}.npf".format(gwfname),
    )
    print("icelltype:",icelltype)
    print("k11:",k11)
    print("k33:",k33)
    

    # åˆå§‹æ°´å¤´
    flopy.mf6.ModflowGwfic(
        gwf, strt=strt, filename="{}.ic".format(gwfname)
    )
    print("strt:",strt[0,100,100])
    print("strt:",strt[1,100,100])
    print("strt:",strt[2,100,100])
    print("strt:",strt[3,100,100])

    # æŒ‡å®šæ°´å¤´è¾¹ç•Œ
    flopy.mf6.ModflowGwfchd(
        gwf,
        maxbound=len(chd_spd_dic),
        stress_period_data=chd_spd_dic,
        save_flows=False,
        auxiliary="CONCENTRATION",
        pname="CHD-1",
        filename="{}.chd".format(gwfname),
    )
    print("chd_spd:",chd_spd[0][:10])
 
    # flopy.mf6.ModflowGwfriv(
    #     gwf, 
    #     stress_period_data=riv_spd
    # )

    # äº•è¾¹ç•Œ
    flopy.mf6.ModflowGwfwel(
        gwf,
        print_input=True,
        print_flows=True,
        stress_period_data=wel_spd,
        save_flows=False,
        auxiliary="CONCENTRATION",
        pname="WEL-1",
        filename="{}.wel".format(gwfname),
    )
    print("wel_spd:",wel_spd)

    # è¡¥ç»™recharge
    flopy.mf6.ModflowGwfrcha(
        gwf,
        recharge=rch,
        filename="{}.rch".format(gwfname),
    )
    print("rch:",rch[100,100])

    # è’¸å‘
    flopy.mf6.ModflowGwfevta(
        gwf,
        surface=et_surf,
        rate=et_rat,
        depth=et_dep,
        filename="{}.evt".format(gwfname),
    )
    print("et_surf:",et_surf[100,100])
    print("et_rat:",et_rat[100,100])
    print("et_dep:",et_dep[100,100])

    # è¾“å‡ºæ§åˆ¶
    flopy.mf6.ModflowGwfoc(
        gwf,
        head_filerecord="{}.hds".format(gwfname),
        budget_filerecord="{}.bud".format(gwfname),
        headprintrecord=[
            ("COLUMNS", 100, "WIDTH", 150, "DIGITS", 6, "GENERAL")
        ],
        saverecord=[("HEAD", "ALL"), ("BUDGET", "ALL")],
        printrecord=[("HEAD", "ALL"), ("BUDGET", "ALL")],
    )

    # GWT
    gwt = flopy.mf6.ModflowGwt(
        sim,
        modelname=gwtname,
        save_flows=True,
        model_nam_file="{}.nam".format(gwtname),
    )

    # æº¶è´¨è¿ç§»æ¨¡å‹æ±‚è§£å‚æ•°
    imsgwt = flopy.mf6.ModflowIms(
        sim,
        print_option="SUMMARY",
        outer_dvclose=hclose,
        outer_maximum=nouter,
        under_relaxation="NONE",
        inner_maximum=ninner,
        inner_dvclose=hclose,
        rcloserecord=rclose,
        linear_acceleration="BICGSTAB",
        scaling_method="NONE",
        reordering_method="NONE",
        relaxation_factor=relax,
        filename="{}.ims".format(gwtname),
    )
    sim.register_ims_package(imsgwt, [gwt.name])

    # ç¦»æ•£åŒ–
    flopy.mf6.ModflowGwtdis(
        gwt,
        nlay=nlay,
        nrow=nrow,
        ncol=ncol,
        delr=delr,
        delc=delc,
        top=top,
        botm=botm,
        idomain=idomain,
        filename="{}.dis".format(gwtname),
    )

    # åˆå§‹æµ“åº¦
    flopy.mf6.ModflowGwtic(
        gwt, strt=sconc, filename="{}.ic".format(gwtname)
    )

    # å¯¹æµ
    flopy.mf6.ModflowGwtadv(
        gwt, scheme="UPSTREAM", filename="{}.adv".format(gwtname)
    )

    # å¼¥æ•£
    flopy.mf6.ModflowGwtdsp(
        gwt,
        alh=al,
        ath1=ath1,
        atv=atv,
        filename="{}.dsp".format(gwtname),
    )

    # åŒ–å­¦ååº” (ç­‰åŒäº MT3DMS çš„ reaction)
    flopy.mf6.ModflowGwtmst(
        gwt,
        porosity=porosity,
        first_order_decay=False,
        decay=None,
        decay_sorbed=None,
        sorption=None,
        bulk_density=None,
        distcoef=None,
        filename="{}.mst".format(gwtname),
    )

    # æºæ±‡é¡¹
    sourcerecarray = [
        ("WEL-1", "AUX", "CONCENTRATION"),
        ("CHD-1", "AUX", "CONCENTRATION"),
    ]
    flopy.mf6.ModflowGwtssm(
        gwt, sources=sourcerecarray, filename="{}.ssm".format(gwtname)
    )

    # è¾“å‡ºæ§åˆ¶
    flopy.mf6.ModflowGwtoc(
        gwt,
        budget_filerecord="{}.cbc".format(gwtname),
        concentration_filerecord="{}.ucn".format(gwtname),
        concentrationprintrecord=[
            ("COLUMNS", 10, "WIDTH", 15, "DIGITS", 6, "GENERAL")
        ],
        saverecord=[("CONCENTRATION", "ALL"), ("BUDGET", "ALL")],
        printrecord=[("CONCENTRATION", "ALL"), ("BUDGET", "ALL")],
    )

    # GWF å’Œ GWT ä¹‹é—´çš„äº¤æ¢
    flopy.mf6.ModflowGwfgwt(
        sim,
        exgtype="GWF6-GWT6",
        exgmnamea=gwfname,
        exgmnameb=gwtname,
        filename="{}.gwfgwt".format(sim_name),
    )
    return sim, gwf, gwt, dis6


sim, gwf1, gwt, dis6 = build_model()
sim.write_simulation(silent = True)

success, buff = sim.run_simulation(silent = True)
if not success:
    raise Exception("MODFLOW 6 did not terminate normally.")


head = gwf.oc.output.head().get_alldata()
concentration = gwt.oc.output.concentration().get_alldata()

```

### æŠŠè®¡ç®—ç»“æœç»˜åˆ¶å‡ºæ¥

```py
import matplotlib.pyplot as plt
def plot_results(model, result):
    fig = plt.figure(figsize = (14, 6))
    ax = fig.add_subplot(1, 1, 1)
    pmv = flopy.plot.PlotMapView(model = model, ax = ax, layer = 0)
    pmv.plot_grid(ax = ax, color = ".5", alpha = 0.2) # ç»˜åˆ¶ç½‘æ ¼
    
    # ç½‘æ ¼å¡«å……é¢œè‰²
    plot_array = pmv.plot_array(result, masked_values = [1e30], cmap = 'bwr')
    plt.colorbar(plot_array)
    # riv = pmv.plot_bc("RIV", alpha = 0.5)
    qm = pmv.plot_bc("CHD", alpha = 0.5)
    
    # ç»˜åˆ¶ç­‰å€¼çº¿
    plot_contour_array = pmv.contour_array(result, masked_values = [1e30], cmap = "brg", linestyles="--")
    plt.clabel(plot_contour_array, fmt = r'%.2f') # ç»˜åˆ¶ç­‰å€¼çº¿ä¸Šæ–‡æœ¬æ ‡æ³¨
    # plt.colorbar(plot_contour_array)              # ç­‰å€¼çº¿å›¾ä¾‹
    
    pmv.plot_bc(package = model.get_package("WEL-1"), color = 'green')
    pmv.plot_inactive(ibound = model.modelgrid.idomain, color_noflow = 'black')
    
    # ç»˜åˆ¶æ°´æµçš„æ–¹å‘ (ç²‰çº¢è‰²ç®­å¤´)
    spdis = gwf.oc.output.budget().get_data(text = 'DATA-SPDIS')[0]
    qx, qy, qz = flopy.utils.postprocessing.get_specific_discharge(spdis, gwf)
    pmv.plot_vector(qx, qy, normalize = True, istep = 10, jstep = 10, color = "pink")

# plot_results(model = gwf1, result = chd[0])
plot_results(model = gwf1, result = head[9,0])
```